<h3 class="movie-topics">New Releases</h3>
<div class="movie-slider-auto">
  <% @new_release_movies = Movie.where("release_date >= ?", (Time.now.ago(1.year))) %>
  <% i=0 %>
  <% @new_release_movies.each do |movie| %>
    <% i+=1 %>
    <div>
      <a href="/movies/moviemodal" data-toggle="modal" data-target="#movie-modal<%= i %>"><%= image_tag(movie.poster_image_url) %></a>
      <p id="movie-title"><%= link_to truncate(movie.title, length: 20), movie_path(movie) %></p>
      <div class="movie-year">
        <%= year(movie.release_date) %>
      </div> 
      <div class="movie-duration">
        <%= min_to_hr(movie.runtime_in_minutes) %>
      </div>
    </div>
  <% end %>
</div>
"%#{params[:search]}%"
<% i=0 %>
<% @new_release_movies.each do |movie| %>
  <% i+=1 %>
  <div class="modal fade" id="movie-modal<%= i %>">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>
          <h4 class="modal-title"><%= movie.title %></h4>
        </div>
        <div class="modal-body">
          <%= link_to image_tag(movie.poster_image_url), movie_path(movie) %>
            <h2><%= movie.title %> (<%= link_to "edit", edit_movie_path(movie) %>, <%= link_to "delete", movie_path(movie), method: :delete, confirm: "You sure?" %>)</h2>
            <h3>Release Date: <%= formatted_date(movie.release_date) %></h3>
            <h4>Director: <%= movie.director %> | <%= movie.runtime_in_minutes %> minutes</h4>
            <h4>Description: <%= movie.description %></h4>

            <hr>

            <h3>Reviews of <em><%= movie.title %></em></h3>
            <% if movie.reviews.any? %>
              <h4>Review Average: <%= movie.review_average %>/10</h4>
            <% end %>
            <% if current_user %>
              <% movie.reviews.each do |review| %>
                <p>Review: <%= review.text %></p>
                <p>Rating: <%= review.rating_out_of_ten %>/10</p>
                <small>- <%= link_to review.user.full_name.titleize, user_path(review.user_id) %></small><br/>
              <% end %>
              <p><%= link_to "Write a review!", new_movie_review_path(movie) %></p>
            <% else %>
              <p>Please <%= link_to "log in", new_session_path %> to see reviews and add your own.</p> 
            <% end %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
<% end %>

<h4 class="movie-topics">Sort By</h4>
<%= form_tag({controller: "movies", action: "index" }, method: "get", class: "sort-by-form") do %>
  <div class="sort-by-selection">
    <%= select_tag(:sort_by, options_for_select(
      [
        ['Please select', ""],
        ['Title', "title"],
        ['Duration', "duration"],
        ['Director', "director"],
        ['Newest', "newest"]
        ], 0
    ), class: "selection-style") %>
  </div>
  <div class="sort-by-search">
    <%= button_tag '<i class="fa fa-search"></i>'.html_safe, class: "search-button" %>
  </div>
<% end %>
<div class="movie-slider">
  <% @movies.each do |movie| %>
    <div>
      <%= link_to image_tag(movie.poster_image_url), movie_path(movie) %>
      <p id="movie-title"><%= link_to truncate(movie.title, length: 20), movie_path(movie) %></p>
      <div class="movie-year">
        <%= year(movie.release_date) %>
      </div> 
      <div class="movie-duration">
        <%= min_to_hr(movie.runtime_in_minutes) %>
      </div>
    </div>
  <% end %>
</div>


<%= render "users/usermodal" %>
